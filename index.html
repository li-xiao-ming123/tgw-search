<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <title>丰川极速文搜</title>

    <!-- PWA 相关 -->
    <link rel="manifest" href="/tgw-search/manifest.json" />
    <meta name="theme-color" content="#4CAF50" />

    <!-- 各种尺寸的图标 -->
    <link rel="icon" type="image/x-icon" href="/tgw-search/icons/favicon.ico" />
    <link
      rel="icon"
      type="image/png"
      sizes="16x16"
      href="/tgw-search/icons/icon-16.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="32x32"
      href="/tgw-search/icons/icon-32.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="192x192"
      href="/tgw-search/icons/icon-192.png"
    />
    <link
      rel="icon"
      type="image/png"
      sizes="512x512"
      href="/tgw-search/icons/icon-512.png"
    />
    <link
      rel="apple-touch-icon"
      href="/tgw-search/icons/apple-touch-icon.png"
    />

    <link rel="stylesheet" href="css/styles.css" />
    <style>
      /* 添加到现有样式表或内联样式 */
      #waifu {
        bottom: -40px; /* 调整底部位置，可以让模型显示得更完整 */
        right: 0;
        line-height: 0;
        margin-bottom: 0;
      }

      #live2d {
        height: 500px; /* 与canvas高度一致 */
        width: 280px; /* 与canvas宽度一致 */
        position: relative;
        z-index: 1;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h1>丰川极速文搜</h1>
      <input
        type="text"
        id="searchInput"
        class="search-box"
        placeholder="请输入搜索关键词"
        autofocus
      />

      <div class="category">
        <div class="category-header">
          <div class="category-title">默认搜索</div>
          <div class="header-actions">
            <div class="checkbox-wrapper">
              <input
                type="checkbox"
                class="site-checkbox"
                onclick="toggleAll(this, 'defaultLinks')"
                id="defaultAll"
              />
              <label for="defaultAll">全选</label>
            </div>
            <button
              class="batch-open"
              onclick="batchOpenSelected('defaultLinks')"
            >
              打开选中
            </button>
          </div>
        </div>
        <div class="link-grid" id="defaultLinks"></div>
      </div>

      <div class="category">
        <div class="category-header">
          <div class="category-title">综合搜索</div>
          <div class="header-actions">
            <div class="checkbox-wrapper">
              <input
                type="checkbox"
                class="site-checkbox"
                onclick="toggleAll(this, 'generalLinks')"
                id="generalAll"
              />
              <label for="generalAll">全选</label>
            </div>
            <button
              class="batch-open"
              onclick="batchOpenSelected('generalLinks')"
            >
              打开选中
            </button>
          </div>
        </div>
        <div class="link-grid" id="generalLinks"></div>
      </div>

      <div class="category">
        <div class="category-header">
          <div class="category-title">学术搜索</div>
          <div class="header-actions">
            <div class="checkbox-wrapper">
              <input
                type="checkbox"
                class="site-checkbox"
                onclick="toggleAll(this, 'researchLinks')"
                id="researchAll"
              />
              <label for="researchAll">全选</label>
            </div>
            <button
              class="batch-open"
              onclick="batchOpenSelected('researchLinks')"
            >
              打开选中
            </button>
          </div>
        </div>
        <div class="link-grid" id="researchLinks"></div>
      </div>

      <div class="category">
        <div class="category-header">
          <div class="category-title">外文搜索</div>
          <div class="header-actions">
            <div class="checkbox-wrapper">
              <input
                type="checkbox"
                class="site-checkbox"
                onclick="toggleAll(this, 'englishLinks')"
                id="englishAll"
              />
              <label for="englishAll">全选</label>
            </div>
            <button
              class="batch-open"
              onclick="batchOpenSelected('englishLinks')"
            >
              打开选中
            </button>
          </div>
        </div>
        <div class="link-grid" id="englishLinks"></div>
      </div>

      <div class="category">
        <div class="category-header">
          <div class="category-title">繁体/古籍</div>
          <div class="header-actions">
            <div class="checkbox-wrapper">
              <input
                type="checkbox"
                class="site-checkbox"
                onclick="toggleAll(this, 'traditionalLinks')"
                id="traditionalAll"
              />
              <label for="traditionalAll">全选</label>
            </div>
            <button
              class="batch-open"
              onclick="batchOpenSelected('traditionalLinks')"
            >
              打开选中
            </button>
          </div>
        </div>
        <div class="link-grid" id="traditionalLinks"></div>
      </div>

      <div class="category">
        <div class="category-header">
          <div class="category-title">自定义搜索源</div>
          <div class="header-actions">
            <div class="checkbox-wrapper">
              <input
                type="checkbox"
                class="site-checkbox"
                onclick="toggleAll(this, 'customLinks')"
                id="customAll"
              />
              <label for="customAll">全选</label>
            </div>
            <button
              class="batch-open"
              onclick="batchOpenSelected('customLinks')"
            >
              打开选中
            </button>
            <button class="batch-open" onclick="addCustomSite()">
              添加网站
            </button>
          </div>
        </div>
        <div class="link-grid" id="customLinks"></div>
      </div>
    </div>

    <div id="notification" class="notification"></div>

    <div id="customSiteModal" class="modal">
      <div class="modal-content">
        <h3>添加自定义搜索源</h3>
        <input
          type="text"
          id="siteName"
          placeholder="网站名称"
          class="search-box"
        />
        <input
          type="text"
          id="siteUrl"
          placeholder="搜索URL（使用 {q} 表示搜索词）"
          class="search-box"
        />
        <div class="modal-buttons">
          <button onclick="saveCustomSite()" class="batch-open">保存</button>
          <button
            onclick="closeModal()"
            class="batch-open"
            style="background: #666"
          >
            取消
          </button>
        </div>
      </div>
    </div>
    <div id="wenshushu-float-btn" class="float-btn" title="文叔叔传文件">
      <div class="float-btn-icon">
        <svg
          xmlns="http://www.w3.org/2000/svg"
          viewBox="0 0 24 24"
          width="24"
          height="24"
          fill="none"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
        >
          <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
          <polyline points="7 10 12 15 17 10"></polyline>
          <line x1="12" y1="15" x2="12" y2="3"></line>
        </svg>
      </div>
      <span class="float-btn-text">传文件</span>
      <div class="tooltip">跳转到文叔叔传文件（可不登录）</div>
    </div>
    <script src="js/main.js"></script>
    <!-- Live2D Widget 脚本 -->
    <!-- 直接引入核心库文件 -->
    <script src="https://cdn.jsdelivr.net/gh/stevenjoezhang/live2d-widget@latest/live2d.min.js"></script>
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/gh/stevenjoezhang/live2d-widget@latest/waifu.css"
    />

    <!-- 添加live2d容器 -->
    <div id="waifu">
      <div id="waifu-tips"></div>
      <canvas id="live2d" width="280" height="500"></canvas>
      <div id="waifu-tool">
        <span class="fa fa-lg fa-comment"></span>
        <span class="fa fa-lg fa-paper-plane"></span>
        <span class="fa fa-lg fa-user-circle"></span>
        <span class="fa fa-lg fa-street-view"></span>
        <span class="fa fa-lg fa-camera-retro"></span>
        <span class="fa fa-lg fa-info-circle"></span>
        <span class="fa fa-lg fa-times"></span>
      </div>
    </div>

    <style>
      /* 调整模型显示样式 */
      #waifu {
        bottom: -40px;
        right: 0;
        line-height: 0;
        margin-bottom: 0;
        z-index: 999;
      }

      #live2d {
        height: 500px;
        width: 280px;
        position: relative;
        z-index: 1;
      }
    </style>

    <!-- 初始化脚本 -->
    <script>
      // 等待页面加载完成
      document.addEventListener("DOMContentLoaded", () => {
        // 加载字体图标库
        const fontAwesomeLink = document.createElement("link");
        fontAwesomeLink.rel = "stylesheet";
        fontAwesomeLink.href =
          "https://cdn.jsdelivr.net/npm/font-awesome/css/font-awesome.min.css";
        document.head.appendChild(fontAwesomeLink);

        // 初始化live2d
        setTimeout(() => {
          // 加载waifu-tips.js
          const script = document.createElement("script");
          script.src =
            "https://cdn.jsdelivr.net/gh/stevenjoezhang/live2d-widget@latest/waifu-tips.js";
          document.body.appendChild(script);

          // 等待waifu-tips.js加载完成后初始化
          script.onload = () => {
            // 初始化看板娘，加载丰川祥子模型
            initWidget({
              waifuPath:
                "https://cdn.jsdelivr.net/gh/stevenjoezhang/live2d-widget@latest/waifu-tips.json",
              apiPath: "", // 留空，不使用默认模型API
              cdnPath: "", // 留空，不使用默认CDN
              tools: [
                "hitokoto",
                "asteroids",
                "switch-model",
                "switch-texture",
                "photo",
                "info",
                "quit",
              ],
            });

            // 直接加载自定义模型
            loadModel("models/togawa/341_school_summer-2023.model.json");

            console.log("丰川祥子模型初始化成功");
          };
        }, 1000);
      });

      // 自定义loadModel函数，直接加载指定模型
      function loadModel(modelPath) {
        if (typeof loadlive2d !== "function") {
          console.error("loadlive2d函数未定义");
          return;
        }

        try {
          // 直接加载模型到canvas，添加缩放参数
          loadlive2d("live2d", modelPath, null, 0.9); // 调整缩放比例
          console.log("模型加载成功:", modelPath);
        } catch (e) {
          console.error("模型加载失败:", e);
        }
      }
    </script>
  </body>
</html>
